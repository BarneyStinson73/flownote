<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>FlowNote - Your Everyday Note Sharing Platform</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <!-- Bootstrap Icons-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Merriweather+Sans:400,700" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic" rel="stylesheet" type="text/css" />
    <!-- SimpleLightbox plugin CSS-->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.css" rel="stylesheet" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="css/styles.css" rel="stylesheet" />
</head>

<body id="page-top">
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top py-3" id="mainNav">
        <div class="container px-4 px-lg-5">
            <a class="navbar-brand" href="#page-top">
                <img src="assets/img/sample_logo.png" width="auto" height="80" alt="FlowNote Logo" />
            </a>
            <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto my-2 my-lg-0">
                    <li class="nav-item"><a class="nav-link text-black-50" href="#about">About</a></li>
                    <li class="nav-item"><a class="nav-link text-black-50" href="#services">Services</a></li>
                    <li class="nav-item"><a class="nav-link text-black-50" href="#signup">Sign Up</a></li>
                    <li class="nav-item"><a class="nav-link text-black-50" href="login.php">Login</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Masthead-->
    <header class="masthead">
        <div class="container px-4 px-lg-5 h-100">
            <div class="row gx-4 gx-lg-5 h-100 align-items-center justify-content-center text-center">
                <div class="col-lg-8 align-self-end">
                    <h1 class="text-white font-weight-bold">Your Favorite Place for Note Sharing</h1>
                    <hr class="divider" />
                </div>
                <div class="col-lg-8 align-self-baseline">
                    <p class="text-white-75 mb-5">FlowNote can help you with collaborating with peers, sharing notes, and managing your study materials effectively. Sticky Notes days are over !!</p>
                    <a class="btn btn-primary btn-xl" href="#about">Find Out More</a>
                </div>
            </div>
        </div>
    </header>
    <!-- About-->
    <section class="page-section bg-primary" id="about">
        <div class="container px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-lg-8 text-center">
                    <h2 class="text-white mt-0">We've got what you need!</h2>
                    <hr class="divider divider-light" />
                    <p class="text-white-75 mb-4">FlowNote has everything you need to get your study materials organized and accessible in no time. Share the resources you have with your peers and vice versa. Collaboration has never been easier!</p>
                    <a class="btn btn-light btn-xl" href="#services">Get Started!</a>
                </div>
            </div>
        </div>
    </section>
    <!-- Services-->
    <section class="page-section" id="services">
        <div class="container px-4 px-lg-5">
            <h2 class="text-center mt-0">At Your Service</h2>
            <hr class="divider" />
            <div class="row gx-4 gx-lg-5">
                <div class="col-lg-3 col-md-6 text-center">
                    <div class="mt-5">
                        <div class="mb-2"><i class="bi-gem fs-1 text-primary"></i></div>
                        <h3 class="h4 mb-2">Secure & Private Sharing</h3>
                        <p class="text-muted mb-0">Your notes are safe with us. We prioritize your privacy and security.</p>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 text-center">
                    <div class="mt-5">
                        <div class="mb-2"><i class="bi-laptop fs-1 text-primary"></i></div>
                        <h3 class="h4 mb-2">Filter & Organization</h3>
                        <p class="text-muted mb-0">All your files are in one place but in topic-wise folders, making it easy to find what you need.</p>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 text-center">
                    <div class="mt-5">
                        <div class="mb-2"><i class="bi-globe fs-1 text-primary"></i></div>
                        <h3 class="h4 mb-2">Universal Accessibility</h3>
                        <p class="text-muted mb-0"> Users can access their notes from anywhereâ€"on a desktop, tablet, or smartphone.</p>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 text-center">
                    <div class="mt-5">
                        <div class="mb-2"><i class="bi-heart fs-1 text-primary"></i></div>
                        <h3 class="h4 mb-2">Seamless Collaboration</h3>
                        <p class="text-muted mb-0">Easily share your notes with classmates and collaborate in real-time.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- SignUp-->
    <section class="page-section" id="signup">
        <div class="container px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-lg-8 col-xl-6 text-center">
                    <h2 class="mt-0">Sign Up</h2>
                    <hr class="divider" />
                    <p class="text-muted mb-5">Ready to start your learning journey with us? Sign Up and get started!</p>
                </div>
            </div>
            <div class="row gx-4 gx-lg-5 justify-content-center mb-5">
                <div class="col-lg-6">
                    <?php
                    include 'config.php';
                    require_once __DIR__ . '/mailer.php';
                    $msg = '';

                    if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['signup'])) {
                        $name    = trim($_POST['name'] ?? '');
                        $email   = trim($_POST['email'] ?? '');
                        $password = $_POST['password'] ?? '';
                        $batch   = trim($_POST['batch'] ?? '');
                        $section = trim($_POST['section'] ?? '');

                        if ($name === '' || !filter_var($email, FILTER_VALIDATE_EMAIL) || $password === '') {
                            $msg = '<div class="alert alert-danger">Please provide a valid name, email, and password.</div>';
                        } else {
                            $hash = password_hash($password, PASSWORD_DEFAULT);
                            $token = bin2hex(random_bytes(16)); // 32 hex chars

                            $stmt = $conn->prepare("INSERT INTO users (name, email, password, batch, section, token, is_verified) VALUES (?, ?, ?, ?, ?, ?, 0)");
                            $stmt->bind_param("ssssss", $name, $email, $hash, $batch, $section, $token);

                            if ($stmt->execute()) {
                                // send verification email
                                if (sendVerificationEmail($email, $name, $token)) {
                                    $msg = '<div class="alert alert-success">Registration successful! Check your email to verify your account.</div>';
                                } else {
                                    $msg = '<div class="alert alert-warning">Registered, but we failed to send the verification email. Contact support.</div>';
                                }
                            } else {
                                // duplicate email or other error
                                if ($conn->errno == 1062) {
                                    $msg = '<div class="alert alert-danger">This email is already registered.</div>';
                                } else {
                                    $msg = '<div class="alert alert-danger">Database error: ' . htmlspecialchars($conn->error) . '</div>';
                                }
                            }
                            $stmt->close();
                        }
                    }

                    // Get submitted values for maintaining form state
                    $selectedBatch = $_POST['batch'] ?? '';
                    $selectedSection = $_POST['section'] ?? '';
                    ?>
                    <?php if (!empty($msg)) echo $msg; ?>
                    <form id="signupForm" method="POST" action="#signup">
                        <!-- Name input-->
                        <div class="form-floating mb-3">
                            <input class="form-control" id="name" name="name" type="text" placeholder="Enter your name..." value="<?= htmlspecialchars($_POST['name'] ?? '') ?>" required />
                            <label for="name">Full name</label>
                            <div class="invalid-feedback" data-sb-feedback="name:required">A name is required.</div>
                        </div>
                        <!-- Email address input-->
                        <div class="form-floating mb-3">
                            <input class="form-control" id="email" name="email" type="email" placeholder="name@example.com" value="<?= htmlspecialchars($_POST['email'] ?? '') ?>" required />
                            <label for="email">Email address</label>
                            <div class="invalid-feedback" data-sb-feedback="email:required">An email is required.</div>
                            <div class="invalid-feedback" data-sb-feedback="email:email">Email is not valid.</div>
                        </div>
                        <!-- Phone number input-->
                        <div class="form-floating mb-3">
                            <input class="form-control" id="password" name="password" type="password" placeholder="Enter your password..." required />
                            <label for="password">Password</label>
                            <div class="invalid-feedback" data-sb-feedback="password:required">A password is required.</div>
                        </div>
                        <!-- Batch number dropdown-->
                        <div class="form-floating mb-3">
                            <select class="form-select" id="batch" name="batch" required>
                                <option value="" disabled <?= !$selectedBatch ? 'selected' : '' ?>>Choose your batch...</option>
                                <?php
                                for ($i = 55; $i <= 77; $i++) {
                                    $selected = ($selectedBatch == $i) ? 'selected' : '';
                                    echo "<option value=\"$i\" $selected>Batch $i</option>";
                                }
                                ?>
                            </select>
                            <label for="batch">Batch number</label>
                            <div class="invalid-feedback" data-sb-feedback="batch:required">A batch number is required.</div>
                        </div>
                        <!-- Section dropdown-->
                        <div class="form-floating mb-3">
                            <select class="form-select" id="section" name="section" required>
                                <option value="" disabled <?= !$selectedSection ? 'selected' : '' ?>>Choose your section...</option>
                                <?php
                                $sections = range('A', 'I');
                                foreach ($sections as $section) {
                                    $selected = ($selectedSection == $section) ? 'selected' : '';
                                    echo "<option value=\"$section\" $selected>Section $section</option>";
                                }
                                ?>
                            </select>
                            <label for="section">Section</label>
                            <div class="invalid-feedback" data-sb-feedback="section:required">A section is required.</div>
                        </div>
                        <!-- Submit success message-->
                        <!---->
                        <!-- This is what your users will see when the form-->
                        <!-- has successfully submitted-->
                        <div class="d-none" id="submitSuccessMessage">
                            <div class="text-center mb-3">
                                <div class="fw-bolder">Form submission successful!</div>
                                To activate this form, sign up at
                                <br />
                                <a href="https://startbootstrap.com/solution/signup-forms">https://startbootstrap.com/solution/signup-forms</a>
                            </div>
                        </div>
                        <div class="d-none" id="submitErrorMessage">
                            <div class="text-center text-danger mb-3">Error sending message!</div>
                        </div>
                        <!-- Submit Button-->
                        <div class="d-grid">
                            <button class="btn btn-primary btn-xl" id="submitButton" name="signup" type="submit">Submit</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-lg-4 text-center mb-5 mb-lg-0">
                    <div> Already have an account? <a href="login.php">Log in</a></div>
                </div>
            </div>
        </div>
    </section>
    <!-- Footer-->
    <footer class="bg-light py-5">
        <div class="container px-4 px-lg-5">
            <div class="small text-center text-muted">Copyright &copy; 2025 - FlowNote</div>
        </div>
    </footer>
    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- SimpleLightbox plugin JS-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.js"></script>
    <!-- Core theme JS-->
    <script src="js/scripts.js"></script>
</body>

</html>